from flask import Flask, request, jsonify  
from flask_cors import CORS
import time
import threading

app = Flask(__name__)  
CORS(app)

process_status = {
    'process': '',
    'percent_process': 0,
    'is_running': False
}

@app.route("/")  
def home():  
    return "runpod app is running!"  

@app.route("/receive_message", methods=["POST"])  
def receive_message():  
    global process_status  
    data = request.get_json()  
    message = data.get("message", "")  
    print("Received message:", message)

    process_status['process'] = "Analysing text"
    process_status['percent_process'] = 0
    process_status['is_running'] = True

    # Simulate processing
    for i in range(1, 11):
        process_status['percent_process'] = i * 10
        time.sleep(1)  # Simulate some processing delay

    process_status['process'] = "Completed"
    process_status['percent_process'] = 100
    process_status['is_running'] = False

    return jsonify({'status': 'success', 'message': 'Processing complete'})

@app.route("/check_progress", methods=["GET"])  
def check_progress():
    return jsonify(process_status)

def run_flask():  
    app.run(port=80)  

flask_thread = threading.Thread(target=run_flask, daemon=True)  
flask_thread.start()  
